# Object Impact Framework

**Object Impact Framework (OIF)** — это плагин для SKSE, который позволяет добавлять пользовательские эффекты к объектам при **активации**, **поднятии**, **отпускании**, **броске**, **ударе**, **обновлении** или **смене погоды**. Можно реализовать такие вещи, как спавн или замена объекта на предметы и персонажей, наложение заклинаний, создание различных визуальных эффектов, воспроизведение звуков и многое другое — все это настраивается через JSON-файлы. Совместимо со всем.

Это руководство объясняет, как настроить эти JSON-файлы, чтобы вы могли создавать собственные моды. Примеры приведены в конце документации.

## Информация для пользователей

- Поместите ваши JSON-файлы в: `Data/SKSE/Plugins/ObjectImpactFramework/`

## Информация для авторов модов

- **Примечание по фильтрам**: объект должен быть задан по крайней мере одним из трех параметров-идентификаторов — `formIDs`, `editorIDs`, `formLists`, `formTypes`, `keywords` — чтобы событие сработало. **Внимание:** эквиваленты с окончанием `Not` не считаются.
- **Примечание по дополнительным полям эффектов**: убедитесь, что вы проверили, требует ли эффект наличия поля `items`. Без указания и заполнения этого поля (хотя бы одним идентификатором (см. **Примечание по фильтрам**) или, если эффект не поддерживает идентификаторы, любым доступным полем) эффект **не** будет работать.
- **Примечание по приоритету**: помещайте эффекты с префиксами `"Remove"` и `"Swap"` в самый конец события, иначе затронутый объект может не успеть вызвать другие эффекты на себе до удаления.
- **Примечание по объектам без коллизии**: поддерживаются только попадания по `flora` и `tree`. Поскольку система основана на обходных путях и математических вычислениях, расчет расположения растений может быть не всегда точным. **Внимание:** заклинания с привязанными снарядами в настоящее время не поддерживаются из-за проблем с хуками.
- **Примечание по работе над ошибками**: если что-то не работает, смотрите файл лога мода для сообщений об ошибках. Лог находится в `Documents/My Games/Skyrim Special Edition/SKSE/ObjectImpactFramework.log`
- Вы можете изменять существующие JSON-файлы не выходя из игры: отредактируйте файл и перезагрузите сохранение.

---

## Содержание

- [Базовая структура правила](#basic-rule-structure)
- [Фильтры: выбор объекта и условий срабатывания](#filters-choosing-which-objects-to-affect-and-how)
  - [Общие фильтры](#general-filters)
  - [Фильтры по времени](#time-based-filters)
  - [Фильтры по близости](#proximity-based-filters)
  - [Фильтры по персонажу-источнику](#source-actor-filters)
  - [Фильтры по событиям удара](#hit-specific-filters)
- [Эффекты: что происходит при срабатывании правила](#effects-what-happens-when-the-rule-triggers)
  - [Типы эффектов](#object-management)
  - [Настройка эффектов через поле items](#configuring-effects-with-items)
- [Примеры](#examples)

---

## Базовая структура правила

Каждое правило в вашем JSON-файле определяет конкретное поведение мода. Правила записываются в виде массива объектов, где каждый объект содержит три основных поля: `event` (событие), `filter` (фильтр) и `effect` (эффект). Вот что делает каждое поле:

- **`event`**: Указывает триггер(ы) для правила. Это массив строк, что позволяет одному правилу срабатывать по нескольким событиям. Допустимые значения:
  - `"Activate"`: срабатывает при активации объекта (например, открытие, использование).
  - `"Hit"`: срабатывает, когда объект поражен оружием, заклинанием или снарядом.
  - `"Grab"`: срабатывает, когда объект поднимается игроком.
  - `"Release"`: срабатывает, когда поднятый объект отпускают.
  - `"Telekinesis"`: срабатывает, когда объект, удерживаемый телекинезом, приземляется.
  - `"Throw"`: срабатывает при броске поднятого объекта (требуется мод **Grab And Throw** от powerofthree).
  - `"CellAttach"`: срабатывает при прикреплении объекта к ячейке (работает также при повторном входе в локацию).
  - `"CellDetach"`: срабатывает при отключении объекта от ячейки.
  - `"WeatherChange"`: срабатывает при смене погоды.
  - `"OnUpdate"`: срабатывает каждые 250 миллисекунд.
  - `"DestructionStageChange"`: срабатывает при смене стадии разрушения объекта. Эффект **не** будет применен к сцене, если объект в ней был отключен или удален.

- **`filter`**: Определяет целевые объекты и условия, при которых правило к ним применяется. Для определения целевых объектов должно быть указано по крайней мере одно из полей `formTypes`, `formIDs`, `editorIDs`, `formLists` или `keywords`.

- **`effect`**: Описывает, что происходит при срабатывании правила. Каждый эффект имеет `type` и, для большинства типов, массив `items`, указывающий, что спавнить, менять или применять.

Вот простой пример правила:

```json
[
    {
        "event": ["Activate", "Hit"],
        "filter": {
            "formTypes": ["activator"]
        },
        "effect": [{
            "type": "SpawnItem",
            "items": [{"formID": "Skyrim.esm:0xF"}]
        }]
    }
]
```

Это правило срабатывает при активации или попадании по активатору (например, рычагу) и спавнит одну золотую монету (`Skyrim.esm:0xF`).

---

## Фильтры: выбор объектов и условий срабатывания

Объект `filter` определяет, какие объекты и условия запускают правило. Он легко настраивается, позволяя точно контролировать процесс применения эффектов.

Ниже перечислены все возможные параметры фильтра:

### Общие фильтры

- **`formTypes`** (одно из обязательных полей для выбора): массив с типами объектов, к которым применяется правило. Возможные значения:
  - `"activator"`: стандартные активаторы (например, рычаги, кнопки).
  - `"talkingactivator"`: активаторы, которые могут «говорить» (например, некоторые квестовые объекты).
  - `"weapon"`: выброшенное в мир оружие (мечи, луки).
  - `"armor"`: предметы брони.
  - `"ammo"`: боеприпасы (стрелы).
  - `"ingredient"`: алхимические ингредиенты.
  - `"misc"`: прочие предметы (мусор, инструменты).
  - `"key"`: ключи.
  - `"book"`: книги и журналы.
  - `"note"`: записки.
  - `"scroll"`: магические свитки.
  - `"soulgem"`: камни душ.
  - `"potion"`: включает зелья, яды, еду и напитки.
  - `"furniture"`: мебель (стулья, кровати).
  - `"door"`: двери и ворота.
  - `"flora"`: срываемые пучки растений и висящие животные.
  - `"container"`: контейнеры (сундуки, бочки).
  - `"static"`: статические объекты (статуи и т. п.).
  - `"moveablestatic"`: подвижные статические объекты.
  - `"tree"`: деревья.
  - `"light"`: источники света с 3D-моделью (факелы и т. п.).

- **`formTypesNot`**: массив типов объектов, к которым правило *не* должно применяться. Формат такой же, как для `formTypes`.

- **`formIDs`** (одно из обязательных полей для выбора): массив, определяющий конкретные объекты по их formID в формате `"modName:formID"`. Примеры:
  - `"Skyrim.esm:0x123456"` (для esp/esm).
  - `"MyMod.esl:0x456"` (для esl/espfe).
  - `"Dawnguard.esm:00123456"` (вариант с ведущими нулями (esp/esm)).
  - `"MyMod.esp:FE000800"` (вариант с префиксом FE (esl/espfe)).

- **`formIDsNot`**: массив с formID объектов, к которым правило *не* должно применяться. Тот же формат, что и для `formIDs`.

- **`editorIDs`** (одно из обязательных полей для выбора): массив, определяющий объекты по editorID в формате `"EditorIDName"`. Пример: `"VendorItemClutter"`.

- **`editorIDsNot`**: массив с rditorID объектов, к которым правило *не* должно применяться. Формат тот же, что и у `editorIDs`.

- **`formLists`** (одно из обязательных полей для выбора): массив формлистов. Каждая запись содержит:
  - **`formID`**: formID формлиста в формате `"modName:formID"` (используйте это поле или `editorID`).
  - **`editorID`**: editorID формлиста в формате `"EditorIDName"` (используйте это поле или `formID`).
  - **`index`** (опционально): целое число, указывающее, какой элемент formlist'а использовать. Пример:

    ```json
    "formLists": [
        {"formID": "Skyrim.esm:0x123456", "index": 0},
        {"editorID": "ExampleFormList"}
    ]
    ```
    - **Индекс `-1`** по умолчанию означает, что будут использованы все элементы одновременно. 
    - **Индекс `-2`** задает параллельные отношения для зеркальных формлистов: происходит синхронизация между формлистами, указанными в `filter` события и `items` эффекта(-ов), с одинаковым количеством элементов, что позволяет выполнять упорядоченные преобразования (например, сырое мясо на позиции 0 из первого формлиста становится приготовленным мясом на позиции 0 из второго формлиста).

- **`formListsNot`**: массив формлистов, к которым правило *не* должно применяться. Формат тот же, что и у `formLists`.

- **`keywords`** (одно из обязательных полей для выбора): массив ключевых слов или формлистов ключевых слов, которые должен иметь объект. Формат: `"modName:formID"` (например, `"Skyrim.esm:0xABCDEF"`), `"EditorIDName"` (например, `"VendorItemFood"`) или formID/editorID formlist'а.

- **`keywordsNot`**: массив ключевых слов или формлистов ключевых слов, которые объект *не* должен иметь. Формат тот же, что и у `keywords`.

- **`chance`**: число от 0 до 100, представляющее шанс срабатывания правила в процентах. По умолчанию 100, если пропущено.

- **`interactions`**: целое число, указывающее, сколько взаимодействий (например, попаданий или активаций) требуется до срабатывания эффекта. По умолчанию 1.

- **`limit`**: целое число, задающее максимальное количество взаимодействий для одного объекта. Если пропущено — нет ограничения.

- **`questItemStatus`**: целое число, указывающее требования к статусу квестового предмета. Работает только с **АКТИВНЫМИ** квестами игрока:
  - `0` (по умолчанию): объект не должен быть квестовым.
  - `1`: объект должен быть только алиасом квеста.
  - `2`: объект должен быть полноценным квестовым предметом.
  - `3`: разрешены все объекты.

- **`isInitiallyDisabled`**: целое число, указывающее, имеет ли объект флаг `kInitiallyDisabled` (изначально отключенный).
  - `0`: объект не отключен изначально.
  - `1`: объект изначально отключен.
  - `2` (по умолчанию): разрешены все объекты.

- **`lockLevel`**: целое число, указывающее требуемый уровень замка у объекта. **Примечание:** используйте этот фильтр только с типами `door` и `container`.
  - `-2` (по умолчанию): игнорировать уровень замка.
  - `-1`: не заперто.
  - `0`: новичок.
  - `1`: ученик.
  - `2`: адепт.
  - `3`: эксперт.
  - `4`: мастер.
  - `5`: требуется ключ.

- **`lockLevelNot`**: целое число, указывающее уровень замка, который объект *не* должен иметь. Формат тот же, что и для `lockLevel`.

- **`isPluginInstalled`**: массив имен плагинов (например, `"MyMod.esp"`, `"Skyrim.esm"`), которые должны быть загружены для применения правила.

- **`isPluginNotInstalled`**: массив имен плагинов, которые *не* должны быть загружены.

- **`isDllInstalled`**: массив имен DLL-файлов (например, `"MyPlugin.dll"`), которые должны присутствовать в `Data/SKSE/Plugins/`.

- **`isDllNotInstalled`**: массив имен DLL-файлов, которые *не* должны присутствовать.

### Фильтры по времени

- **`timer`**: заданное количество секунд до срабатывания эффекта (например, `"timer": 1.0`). **Опциональная** расширенная запись:
  - **`time`**: количество секунд.
  - **`matchFilterRecheck`**: нужно ли отменять эффект, если условия были нарушены во время ожидания.
    - `0`: без повторной проверки.
    - `1`: с повторной проверкой.

  ```json
  "timer": {"time": "1.0", "matchFilterRecheck": 1}
  ```

- **`time`**: массив внутреигровых временных условий, которые должны быть активны для применения правила. Формат: `["Hour >= 10", "DayOfWeek = 1"]`. Доступные записи:
  - `Minute` (минута)
  - `Hour` (час)
  - `Day` (день)
  - `DayOfWeek` (день недели)
  - `Month` (месяц)
  - `Year` (год)
  - `GameTime` (время в игре)

- **`timeNot`**: массив внутреигровых временных условий, которые *не* должны быть активны. Формат тот же, что и у `time`.

### Фильтры по близости

- **`nearbyObjects`**: массив объектов, которые должны находиться в определенном радиусе вокруг целевого объекта, чтобы правило применилось. Каждая запись содержит:
  - **`formID`**: formID объекта или formID формлиста в формате `"modName:formID"` (используйте это или `editorID`).
  - **`editorID`**: editorID в или editorID формлистa формате `"EditorIDName"` (используйте это или `formID`).
  - **`radius`**: целое число, указывающее радиус поиска. Пример:

    ```json
    "nearbyObjects": [
        {"formID": "Skyrim.esm:0x123456", "radius": 150},
        {"editorID": "Player", "radius": 300}
    ]
    ```
- **`nearbyObjectsNot`**: массив объектов, которых *не* должно быть в указанном радиусе. Формат тот же, что и у `nearbyObjects`.

- **`locations`**: массив ячеек, локаций или мировых пространств, в которых правило должно применяться. Формат: `"modName:formID"` (например, `"Skyrim.esm:0xABCDEF"`), `"EditorIDName"` (например, `"VendorItemFood"`) или formID/editorID формлиста. **Примечание:** мировое пространство не будет определено и событие будет отфильтровано, если у ячейки нет привязанной информации о нем.

- **`locationsNot`**: массив ячеек, локаций или мировых пространств, в которых правило *не* должно применяться. Формат тот же, что и у `locations`.

- **`weathers`**: массив видов погоды, при которых правило должно применяться. Формат: `"modName:formID"` (например, `"Skyrim.esm:0xABCDEF"`), `"EditorIDName"` (например, `"VendorItemFood"`) или formID/editorID формлиста.

- **`weathersNot`**: массив видов погоды, при которых правило *не* должно применяться. Формат тот же, что и у `weathers`.

### Фильтры по персонажу-источнику

- **`perks`**: массив перков, которые должен иметь источник события (персонаж). Формат: `"modName:formID"` (например, `"Skyrim.esm:0xABCDEF"`), `"EditorIDName"` (например, `"VendorItemFood"`) или formID/editorID формлиста.

- **`perksNot`**: массив перков, которые источник события *не* должен иметь. Формат тот же, что и у `perks`.

- **`spells`**: массив заклинаний, которые должен иметь источник события. Формат: `"modName:formID"` (например, `"Skyrim.esm:0xABCDEF"`), `"EditorIDName"` (например, `"VendorItemFood"`) или formID/editorID формлиста.
  
- **`spellsNot`**: массив заклинаний, которых источник события *не* должен иметь.

- **`hasItem`**: массив предметов, которые должны быть в инвентаре источника события. Формат: `"modName:formID"` (например, `"Skyrim.esm:0xABCDEF"`), `"EditorIDName"` (например, `"VendorItemFood"`) или formID/editorID формлиста.

- **`hasItemNot`**: массив предметов, которых не должно быть в инвентаре источника события.

- **`actorKeywords`**: массив ключевых слов, которые должны быть у источника события. Формат: `"modName:formID"` (например, `"Skyrim.esm:0xABCDEF"`), `"EditorIDName"` (например, `"VendorItemFood"`) или formID/editorID формлиста.

- **`actorKeywordsNot`**: массив ключевых слов, которых не должно быть у источника события.

- **`actorRaces`**: массив рас источника события. Формат: `"modName:formID"` (например, `"Skyrim.esm:0xABCDEF"`), `"EditorIDName"` (например, `"VendorItemFood"`) или formID/editorID формлиста.

- **`actorRacesNot`**: массив рас, которых не должно быть у источника события.

- **`actorValues`**: массив условий по значениям источника события, которым он должен соответствовать. Формат: `["Health >= 10", "Aggression = 0"]`.

- **`actorValuesNot`**: массив условий по значениям источника события, которым он *не* должен соответствовать. Формат тот же, что и у `actorValues`.

- **`level`**: массив условий по уровню источника события. Формат: `[">= 10", "= 20"]`.

- **`levelNot`**: массив условий по уровню, которым источника события *не* должен соответствовать.

Целое число, указывающее, находится ли источник события:
- **`isSneaking`**: в состоянии скрытности.
- **`isSwimming`**: в состоянии плавания.
- **`isInCombat`**: в бою.
- **`isMounted`**: верхом.
- **`isDualCasting`**: в состоянии каста двумя руками.
- **`isSprinting`**: в состоянии спринта.
- **`isWeaponDrawn`**: с обнаженным оружием.
  - `0`: источник события *не* находится в данном состоянии.
  - `1`: источник события в данном состоянии.
  - `2` (по умолчанию): разрешены все состояния.

### Фильтры по событиям удара

Для правил с событием `"Hit"` дополнительные фильтры уточняют, какие именно атаки вызывают правило:

- **`destructionStage`**: проверка по текущей стадии разрушения. Возможные значения:
  - `-1` (по умолчанию): все стадии разрешены.
  - `0`, `1` и т. д.: конкретный индекс стадии разрушения.

- **`weaponsTypes`**: массив типов оружия или заклинаний, которыми должно быть нанесено попадание. Возможные значения:
  - `"onehandsword"`: одноручные мечи.
  - `"twohandsword"`: двуручные мечи.
  - `"onehandaxe"`: одноручные топоры.
  - `"twohandaxe"`: двуручные топоры.
  - `"onehandmace"`: одноручные булавы.
  - `"twohandmace"`: двуручные булавы.
  - `"dagger"`: кинжалы.
  - `"ranged"`: луки, арбалеты и снаряды.
  - `"staff"`: посохи.
  - `"handtohand"`: безоружная атака.
  - `"spell"`: заклинания.
  - `"scroll"`: свитки.
  - `"shout"`: крики. **Примечание:** крики не работают со статическими объектами. Те крики, которые являются чистыми снарядами (например, Безжалостная сила), будут работать только с `furniture`, `flora`, `doors`, `containers` и `activators`.
  - `"ability"`: расовые или иные способности.
  - `"power"`: силы.
  - `"lesserpower"`: меньшие силы.
  - `"explosion"`: взрывы.
  - `"total"`: еще не выяснено. Предположительно соответствует всем типам оружия.
  - `"other"`: прочие типы, не описанные выше.

- **`weaponsTypesNot`**: массив типов оружия или заклинаний, которые *не* должны использоваться.

- **`weapons`**: массив конкретного оружия или заклинаний. Формат: `"modName:formID"` (например, `"Skyrim.esm:0xABCDEF"`), `"EditorIDName"` (например, `"VendorItemFood"`) или formID/editorID формлиста.

- **`weaponsNot`**: массив конкретных оружий или заклинаний, которые *не* должны использоваться.

- **`weaponsKeywords`**: массив ключевых слов, которые должны иметь оружие или заклинание. Формат: `"modName:formID"` (например, `"Skyrim.esm:0xABCDEF"`), `"EditorIDName"` (например, `"VendorItemFood"`) или formID/editorID формлиста.

- **`weaponsKeywordsNot`**: массив ключевых слов, которых *не* должно быть у оружия или заклинания.

- **`attacksTypes`** или **`attacks`**: массив типов атак. Возможные значения:
  - `"regular"` (по умолчанию): обычные атаки.
  - `"power"`: силовые атаки.
  - `"bash"`: удары щитом или оружием в качестве блока.
  - `"charge"`: атакующие при разбеге.
  - `"rotating"`: вращающиеся атаки.
  - `"continuous"`: концентрируемые заклинания (например, пламя).
  - `"constant"`: заклинания с постоянным эффектом
  - `"fireandforget"`: заклинания с мгновенным эффектом.
  - `"ignoreweapon"`: атаки, игнорирующие оружие.
  - `"overridedata"`: атаки, переопределяющие стандартные данные.

- **`attacksTypesNot`** или **`attacksNot`**: массив типов атак, которые *не* должны использоваться.

- **`deliveryTypes`**: массив типов доставки заклинаний. Возможные значения:
  - `"self"`: заклинания, направленные на себя.
  - `"aimed"`: прицельные заклинания.
  - `"targetactor"`: заклинания на целевого актера.
  - `"targetlocation"`: заклинания на целевое место.
  - `"touch"`: заклинания по прикосновению.
  - `"total"`: еще не раскрыто. Предположительно соответствует всем типам доставки.
  - `"none"`: нет.

- **`deliveryTypesNot`**: массив типов доставки, которые *не* должны использоваться.

- **`allowProjectiles`**: целое число, определяющее, разрешены ли снаряды. Возможные значения:
  - `0`: снаряды запрещены.
  - `1` (по умолчанию): снаряды разрешены.

- **`projectiles`**: массив конкретных снарядов. Формат: `"modName:formID"` (например, `"Skyrim.esm:0xABCDEF"`), `"EditorIDName"` (например, `"VendorItemFood"`) или formID/editorID формлиста.

- **`projectilesNot`**: массив конкретных снарядов, которые *не* должны использоваться.

---

## Эффекты: что происходит при срабатывании правила

Поле `effect` определяет результат срабатывания правила. Оно может быть одиночным эффектом (объект) или несколькими эффектами (массив объектов). Каждый эффект обязан иметь поле `type` и, для большинства типов, опциональный массив `items`.

Ниже перечислены все возможные значения `type` и поддерживаемые для них поля:

### Утилитарные эффекты
- **`ExecuteConsoleCommand`**: выполняет консольную команду на близлежащих акторах.
  - Поддерживаемые поля: `string`, `chance`, `timer`.

- **`ExecuteConsoleCommandOnItem`**: выполняет консольную команду на целевом объекте.
  - Поддерживаемые поля: `string`, `chance`, `timer`.

- **`ExecuteConsoleCommandOnSource`**: выполняет консольную команду на актере, взаимодействовавшем с объектом.
  - Поддерживаемые поля: `string`, `chance`, `timer`.

- **`ShowNotification`**: показывает уведомление.
  - Поддерживаемые поля: `string`, `chance`, `timer`.

- **`ShowMessageBox`**: показывает ящик сообщения с кнопкой «OK».
  - Поддерживаемые поля: `string`, `chance`, `timer`.

### Управление объектами
- **`RemoveItem`**: удаляет целевой объект.
  - Поле `items` не требуется.

- **`EnableItem`**: включает (включает видимость/активность) целевой объект.
  - Поле `items` не требуется.

- **`DisableItem`**: отключает целевой объект.
  - Поле `items` не требуется.

- **`UnlockItem`**: отмыкает целевой объект (с анимацией).
  - Поле `items` не требуется.

- **`LockItem`**: запирает целевой объект (с анимацией).
  - Поле `items` не требуется.

- **`ActivateItem`**: активирует целевой объект. Ведет себя так же, как нажатие `E` для всех типов форм. **Не** работает с событием `Activate`, чтобы избежать конфликтов.
  - Поле `items` не требуется.

### Управление инвентарем
- **`SpillInventory`**: высыпает содержимое контейнера.
  - Поле `items` не требуется.

- **`AddContainerItem`**: добавляет указанные предметы в содержимое контейнера.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `chance`, `timer`.

- **`AddActorItem`**: добавляет указанные предметы в инвентарь актера, который взаимодействовал с объектом.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `chance`, `timer`.

- **`RemoveContainerItem`**: удаляет указанные предметы из содержимого контейнера.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `chance`, `timer`.

- **`RemoveActorItem`**: удаляет указанные предметы из инвентаря актера, который взаимодействовал с объектом.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `chance`, `timer`.

### Спавн и замена предметов
- **`SpawnItem`**: спавнит указанные предметы в позиции объекта.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `scale`, `fade`, `spawnType`, `string`, `chance`, `timer`.

- **`SpawnLeveledItem`**: спавнит случайные предметы уровня, основанные на уровне игрока.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `scale`, `fade`, `spawnType`, `string`, `chance`, `timer`.

- **`SwapItem`**: заменяет целевой объект на другой конкретный предмет.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `scale`, `fade`, `spawnType`, `string`, `nonDeletable`, `chance`, `timer`.

- **`SwapLeveledItem`**: заменяет целевой объект на случайный предмет уровня.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `scale`, `fade`, `spawnType`, `string`, `nonDeletable`, `chance`, `timer`.

### Спавн и замена актеров
- **`SpawnActor`**: спавнит указанных актеров в позиции объекта.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `scale`, `fade`, `spawnType`, `string`, `chance`, `timer`.

- **`SpawnLeveledActor`**: спавнит случайных актеров уровня.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `scale`, `fade`, `spawnType`, `string`, `chance`, `timer`.

- **`SwapActor`**: заменяет целевой объект на указанных актеров.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `scale`, `fade`, `spawnType`, `string`, `nonDeletable`, `chance`, `timer`.

- **`SwapLeveledActor`**: заменяет целевой объект на случайных актеров уровня.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `scale`, `fade`, `spawnType`, `string`, `nonDeletable`, `chance`, `timer`.

### Магические эффекты
- **`SpawnSpell`**: накладывает заклинания на близлежащих актеров.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `radius`, `chance`, `timer`.

- **`SpawnLeveledSpell`**: накладывает случайные заклинания уровня на близлежащих актеров.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `radius`, `chance`, `timer`.

- **`SpawnSpellOnItem`**: накладывает заклинание на целевой объект.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `chance`, `timer`.

- **`SpawnLeveledSpellOnItem`**: накладывает случайное заклинание уровня на целевой объект.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `chance`, `timer`.

- **`ApplySpell`**: применяет заклинание самого целевого объекта (если это свиток или том заклинаний) к близлежащим актерам.
  - Поддерживаемые поля: `radius`, `chance`, `timer`.

- **`ApplyIngestible`**: применяет эффекты целевого предмета (если это ингредиент или съестное) к близлежащим актерам.
  - Поддерживаемые поля: `radius`, `chance`, `timer`.

- **`ApplyOtherIngestible`**: применяет эффекты указанных съестных предметов. Может использоваться с любым типом форм.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `radius`, `chance`, `timer`.

- **`AddActorSpell`**: добавляет указанные заклинания источнику события.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `chance`, `timer`.

- **`RemoveActorSpell`**: удаляет указанные заклинания у источника события.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `chance`, `timer`.

- **`AddActorPerk`**: добавляет указанные перки источнику события.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `rank`, `chance`, `timer`.

- **`RemoveActorPerk`**: удаляет указанные перки у источника события (независимо от ранга перка).
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `chance`, `timer`.

### Визуальные и аудио эффекты
- **`PlaySound`**: воспроизводит звуковой дескриптор.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `chance`, `timer`.

- **`PlayIdle`**: проигрывает анимацию на актере, взаимодействовавшем с объектом. [Список доступных имен анимаций](https://forums.nexusmods.com/topic/11007808-le-list-of-animation-events-for-debugsendanimationevent/?do=findComment&comment=105617168).
  - Поддерживаемые поля: `string`, `duration`, `chance`, `timer`.

- **`SpawnImpactDataSet`**: воспроизводит impact data set (не путать с impacts).
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `chance`, `timer`.

- **`SpawnExplosion`**: вызывает взрыв в позиции объекта.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `fade`, `spawnType`, `chance`, `timer`.

- **`SpawnEffectShader`**: создает эффектный шейдер на близлежащих актерах.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `radius`, `duration`, `chance`, `timer`.

- **`SpawnEffectShaderOnItem`**: создает эффектный шейдер на целевом объекте.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `duration`, `chance`, `timer`.

- **`SpawnArtObject`**: спавнит арт-объекты на близлежащих актерах.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `radius`, `duration`, `chance`, `timer`.

- **`SpawnArtObjectOnItem`**: спавнит арт-объекты на целевом объекте.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `duration`, `chance`, `timer`.

- **`ToggleNode`**: включает/выключает ноды (масштабирует до 0.00001 или 1.0).
  - Поддерживаемые поля: `mode`, `strings`, `chance`, `timer`.

### Эффекты освещения
- **`SpawnLight`**: создает источник света в позиции объекта.
  - Поддерживаемые поля: `formID`, `editorID`, `formList`, `count`, `fade`, `spawnType`, `string`, `chance`, `timer`.

- **`RemoveLight`**: удаляет источники света.
  - Поддерживаемые поля: `radius`, `chance`, `timer`.

- **`DisableLight`**: отключает источники света.
  - Поддерживаемые поля: `radius`, `chance`, `timer`.

- **`EnableLight`**: включает ранее отключенные источники света.
  - Поддерживаемые поля: `radius`, `chance`, `timer`.

---

### Настройка эффектов через `items`

Для типов эффектов, которые поддерживают массив `items`, вы можете задать детальные конфигурации. Каждый элемент массива может включать:

- **`formID`**: конкретный Form ID в формате `"modName:formID"` (например, `"Skyrim.esm:0xF"` для золотой монеты).

- **`editorID`**: конкретный Editor ID в формате `"EditorIDName"` (например, `"VendorItemClutter"` для мусора).

- **`formList`**: массив записей formlist'ов.
  - **`formID`**: formID formlist'а в формате `"modName:formID"` (используйте это или `editorID`).
  - **`editorID`**: editorID formlist'а в формате `"EditorIDName"` (используйте это или `formID`).
  - **`index`** (опционально): целое число, указывающее, какой элемент formlist'а использовать:
    - `-1` (по умолчанию): все элементы одновременно.
    - `-2`: параллельное соответствие для зеркальных formlist'ов.
    - `-3`: выбрать один случайный объект из списка.
    - Другие значения: конкретный индекс в formlist'е.

    Пример:
    ```json
    "formList": [
        {"formID": "Skyrim.esm:0x123456", "index": 0},
        {"formID": "MyMod.esp:0x789ABC", "index": -3}
    ]
    ```

- **`chance`**: число от 0 до 100, процент шанса использования этого элемента. По умолчанию 100.

- **`timer`**: указанное количество секунд до срабатывания эффекта (например, `"timer": 1.0`). **Опциональная** детальная запись:
  - **`time`**: количество секунд.
  - **`matchFilterRecheck`**: нужно ли отменять эффект, если условия были нарушены в ожидании.
    - `0`: без повторной проверки.
    - `1`: с повторной проверкой.

    ```json
    "timer": {"time": "1.0", "matchFilterRecheck": 1}
    ```

- **`count`**: целое число, указывающее, сколько экземпляров спавнить или заменить. По умолчанию 1.

- **`radius`**: радиус в игровых единицах для применения эффекта. Значения по умолчанию зависят от типа эффекта.

- **`duration`**: для `PlayIdle` по умолчанию 1.0 (меньшие значения делают анимацию быстрее). Для эффект-шейдеров и арт-объектов задает длительность эффекта.

- **`string`**: используется для разных эффектов. Принимает одну запись. Для `spawn` и `swap` эффектов используется для указания имени ноды. Для `PlayIdle` — имя анимации.

- **`strings`**: используется для разных эффектов. Принимает несколько записей. Для `ToggleNode` используется для указания имен нод.

- **`mode`**: используется для разных эффектов. В настоящее время применяется в эффекте `ToggleNode` для указания режима отключения/включения.
  - `0` (по умолчанию): выключить.
  - `1`: включить.

- **`nonDeletable`**: используется только для функций `swap`. При замене исходный объект деактивируется, а на его месте появляется новый. Это значение определяет, будет ли исходный объект удален (`0`) или только отключен (`1`).

- **`scale`**: используется только для `spawn/swap`. Позволяет задать масштаб создаваемого предмета. По умолчанию копируется с целевого объекта.

- **`fade`**: используется только для `spawn/swap`. Определяет, будет ли у объекта эффект затухания при создании:
  - `0`: без эффекта затухания (не используйте с **explosions**).
  - `1` (по умолчанию): с эффектом затухания.

- **`spawnType`**: используется только для `spawn/swap`. Позволяет выбрать тип спавна объекта. Опции:
  - `0`: Обычный PlaceAtMe().
  - `1`: PlaceAtMe() — спавн объекта в центре оригинала.
  - `2`: PlaceAtMe() — спавн вверху оригинала.
  - `3`: PlaceAtMe() — спавн внизу оригинала.
  - `4` (по умолчанию): Обычный PlaceAtMe() с обходом багов физики движка (например, при использовании с `Throw`/`Grab`/`Release` объект будет спавниться точно в точке приземления без глюков позиции).
  - `5`: Обход с спавном в центре оригинала.
  - `6`: Обход со спавном вверху оригинала.
  - `7`: Обход со спавном внизу оригинала.
  - `8`: Прикрепить к земле независимо от места приземления (например, при использовании с `Throw`, объект, приземлившийся на стену, породит новый прямо под ним на полу).
  - `9`: Прикрепить к указанной ноде. Требует передачи имени ноды или ее подстроки в `string`.

  **ПРИМЕЧАНИЕ**: если вы хотите спавнить **взрывы**, используйте только `0` или `4`.

---

## Примеры

1. **Спавн золотой монеты при активации**
   ```json
   [
       {
           "event": ["Activate"],
           "filter": {
               "formTypes": ["container"]
           },
           "effect": {
               "type": "SpawnItem",
               "items": [{"formID": "Skyrim.esm:0xF"}]
           }
       }
   ]
   ```
   - Активация контейнера спавнит одну золотую монету.

2. **Удаление объекта при попадании**
   ```json
   [
       {
           "event": ["Hit"],
           "filter": {
               "formTypes": ["static"]
           },
           "effect": {
               "type": "RemoveItem"
           }
       }
   ]
   ```
   - Попадание по статическому объекту удаляет его.

3. **Спавн предметов с шансами и пользовательским масштабом**
   ```json
   [
       {
           "event": ["Hit"],
           "filter": {
               "formTypes": ["container"]
           },
           "effect": {
               "type": "SpawnItem",
               "items": [
                   {"formID": "Skyrim.esm:0xF", "count": 5, "chance": 50, "scale": 1.5},
                   {"formID": "Skyrim.esm:0xA", "count": 2, "chance": 30, "fade": 1}
               ]
           }
       }
   ]
   ```
   - Попадание по контейнеру с вероятностью 50% спавнит 5 золотых монет с масштабом 1.5 и с вероятностью 30% — 2 отмычки с эффектом затухания.

4. **Взрыв деревьев при попадании**
   ```json
   [
       {
           "event": ["Hit"],
           "filter": {
               "formTypes": ["tree"]
           },
           "effect": {
               "type": "SpawnExplosion",
               "items": [{"formID": "Skyrim.esm:0x123456"}]
           }
       }
   ]
   ```
   - Попадание по дереву вызывает взрыв.

5. **Использование FormLists с рандомным выбором**
   ```json
   [
       {
           "event": ["Activate"],
           "filter": {
               "formTypes": ["container"]
           },
           "effect": {
               "type": "SpawnItem",
               "items": [
                   {
                       "formList": [
                           {"formID": "MyMod.esp:0x789ABC", "index": 2},
                           {"formID": "Skyrim.esm:0x123456", "index": -3}
                       ],
                       "count": 1,
                       "chance": 100
                   }
               ]
           }
       }
   ]
   ```
   - Активация контейнера спавнит предмет из formlist'а по индексу 2 в `MyMod.esp:0x789ABC` и один случайный предмет из `Skyrim.esm:0x123456`.

6. **Проиграть анимацию при попадании**
   ```json
   [
       {
           "event": ["Hit"],
           "filter": {
               "formTypes": ["activator"]
           },
           "effect": {
               "type": "PlayIdle",
               "items": [{"string": "IdleName", "duration": 0.5}]
           }
       }
   ]
   ```
   - Попадание по активатору проигрывает анимацию "IdleName" в 0.5× скорости.

7. **Спавн эффектного шейдера с пользовательской длительностью**
   ```json
   [
       {
           "event": ["Activate"],
           "filter": {
               "formTypes": ["static"]
           },
           "effect": {
               "type": "SpawnEffectShaderOnItem",
               "items": [
                   {
                       "formID": "Skyrim.esm:0x123456",
                       "duration": 5.0
                   }
               ]
           }
       }
   ]
   ```
   - Активация статического объекта создает эффектный шейдер на нем длительностью 5 секунд.

8. **Зависимые от погоды и значений актера эффекты**
   ```json
   [
       {
           "event": ["Hit"],
           "filter": {
               "formTypes": ["tree"],
               "weathers": ["Skyrim.esm:0x123456"],
               "actorValues": ["Health >= 50"],
               "level": [">= 10"]
           },
           "effect": {
               "type": "SpawnSpell",
               "items": [
                   {
                       "formID": "Skyrim.esm:0x789ABC",
                       "radius": 500
                   }
               ]
           }
       }
   ]
   ```
   - Попадание по дереву в указанную погоду актером с не менее чем 50 HP и уровнем 10+ накладывает заклинание на актеров в радиусе 500 единиц.

9. **Фильтрация квестовых предметов с проверкой инвентаря**
    ```json
    [
        {
            "event": ["Grab"],
            "filter": {
                "formTypes": ["misc"],
                "questItemStatus": 2,
                "hasItem": ["Skyrim.esm:0x123456"]
            },
            "effect": {
                "type": "PlaySound",
                "items": [{"formID": "Skyrim.esm:0x456789"}]
            }
        }
    ]
    ```
    - Поднятие полноценного квестового предмета актером, имеющим в инвентаре указанный предмет, проигрывает звук.

10. **Применение съестного с пользовательским радиусом**
    ```json
    [
        {
            "event": ["Activate"],
            "filter": {
                "formTypes": ["ingredient"]
            },
            "effect": {
                "type": "ApplyIngestible",
                "items": [{"radius": 300, "chance": 75}]
            }
        }
    ]
    ```
    - Активация ингредиента применяет его эффекты к актерам в радиусе 300 единиц с вероятностью 75%.
